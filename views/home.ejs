<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous" />

    <!-- jì¿¼ë¦¬ -->
    <script src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

    <!-- êµ¬ê¸€í°íŠ¸ -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
        href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Serif+KR&family=Stylish&display=swap"
        rel="stylesheet" />

    <!-- font-family: 'Black Han Sans', sans-serif; -->
    <!-- font-family: 'Noto Serif KR', serif; -->
    <!-- font-family: 'Stylish', sans-serif; -->


    <title>Document</title>
</head>

<body>
    <div style="margin:auto; text-align:center;">
        <div style="margin-bottom:50px; font-family: 'Noto Serif KR', serif;">

            <h1>ì¸ìŠ¤íƒ€ ì˜ˆì œ íŒŒì¼ ë¡œê·¸ì¸ì´ ì„±ê³µí–ˆì–´^^ </h1> <br>
            <h1>ê°€ì„œ í† í°ã…‡ì„ ë³´ì„¸ìš” ^^</h1>

            <div style="font-family: 'Black Han Sans', sans-serif; font-size:20px;">
                <hr>ë©”ì¸ ê²Œì‹œíŒ <span style="font-family: 'Noto Serif KR', serif;">(ì¹œêµ¬ì˜ ê¸€ë§Œ ë³´ì¸ë‹µë‹ˆë‹¤ ã…‡ã……ã…‡)</span>
                <hr>
            </div>
            <div id="board_list">
            </div>

            <div style="margin:auto;">
                <p>ê²Œì‹œê¸€ ë‚´ìš© <input type="text" id="contents"></p>

            </div><input type='file' id='file' name="file_name" multiple enctype='form-data'>

            <button onclick="write_board()">ì‘ì„±
                ì™„ë£Œ</button>
        </div>

        <div id="friend_list_show_recommend"
            style="font-family: 'Black Han Sans', sans-serif; font-size:20px; margin-top:100px;">
            <hr>ì¹œêµ¬ ì¶”ì²œ
            <hr>
        </div>

        <div style="font-family: 'Black Han Sans', sans-serif; font-size:20px; margin-top:100px;">

            <hr>
            <button onclick="my_friend_list_show()" style="font-family: 'Stylish', sans-serif;">ì¹œêµ¬ ëª©ë¡ í™• ì¸</button>
            <hr>

        </div>
        <div id="my_freind_list_show" style="font-family: 'Stylish', sans-serif;"></div>
    </div>

    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const instaId = urlParams.get("instaId");

        // ìë™ ì‹œì‘
        $(document).ready(function () {
            get_friend_detail()
            get_show_board()
        });

        // ì¹œêµ¬ ì¶”ì²œ ë¿Œë ¤ì£¼ê¸°
        function get_friend_detail() {
            $.ajax({
                type: "POST",
                url: '/api/friend_list',
                headers: { token: localStorage.getItem('token') },
                data: {
                },
                success: function (response) {

                    let my_nick = response["name"]
                    let friend = response["friend_list"];
                    for (let i = 0; i < friend.length; i++) {

                        if (my_nick !== friend[i]["name"]) {

                            let name = friend[i]["name"];
                            let tempHtml = `
                <div class="alert alert-warning alert-dismissible fade show" role="alert" style="width:500px; margin:auto;">
                <strong style="font-family: 'Stylish', sans-serif; color:hotpink;">${name}</strong> <span style="font-family: 'Noto Serif KR', serif; color:black;"></span>

                <button class="login_Btn" type="button" onclick="add_friend('${name}')" style="font-size:20px; font-family: 'Stylish', sans-serif; border:none; outline:none; background:none; float:right;">ì¹œì¶”^^</button>
                    </div>`;
                            $("#friend_list_show_recommend").append(tempHtml);
                        }
                    }
                },
            });
        }

        // ì¹œêµ¬ ì¶”ê°€í•˜ê¸°
        function add_friend(name) {
            const result = confirm(name + "ë‹˜ì„ ì¹œêµ¬ ì¶”ê°€ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
            if (result) {
                $.ajax({
                    type: "POST",
                    url: "/api/add_friend",
                    headers: { token: localStorage.getItem('token') },
                    data: {
                        "name": name,
                    },
                    success: function (response) {
                        console.log(response)
                        alert(response)
                    },
                });
                window.location.href = "/home";
            }
        }

        // ì¹œêµ¬ ëª©ë¡ ë³´ì—¬ì£¼ê¸°
        function my_friend_list_show() {
            $('#my_freind_list_show').empty()
            $.ajax({
                type: "GET",
                url: '/api/my_friend_list_show',
                headers: { token: localStorage.getItem('token') },
                data: {},
                success: function (response) {
                    let friend_list = response['my_friend_list_show']
                    for (let i = 1; i < friend_list.length; i++) {
                        let tempHtml = `
                        <h3 style="color:orange" >${friend_list[i]}
                            <button onclick="delete_friend('${friend_list[i]}')" style="border:none; outline:none; background:none;">âŒ</button>
                            </h3>`
                        $("#my_freind_list_show").append(tempHtml);
                    }
                },
            });
        }

        // ì¹œêµ¬ ì‚­ì œ
        function delete_friend(nickname) {
            $.ajax({
                type: "POST",
                url: "/api/delete_friend",
                headers: { token: localStorage.getItem('token') },
                data: {
                    "nickname": nickname,
                },
                success: function (response) {
                },
            });
            alert("ì‚­ì œ ì™„ë£Œ!")
            window.location.href = "/home";
        }

        // ê²Œì‹œê¸€ ì‘ì„±
        function write_board() {
            alert("ì‘ì„± ì‹œì‘")


            let formData = new FormData();
            let inputFile = $('input[name="file_name"]');
            let files = inputFile[0].files;

            for (let i = 0; i < files.length; i++) {
                formData.append("file", files[i]);
            }

            console.log(formData)
            // formData.append("token", localStorage.getItem("token"))
            $.ajax({
                type: "POST",
                url: "/upload",
                headers: { token: localStorage.getItem('token') },
                data: formData,
                success: function (response) {
                },
            });
            window.location.href = "/home";
            alert("ì‘ì„± ì™„ë£Œ!")
        }

        // ê²Œì‹œê¸€ í”¼ë“œ ë³´ì—¬ì£¼ê¸°
        function get_show_board() {
            $.ajax({
                type: "POST",
                headers: { token: localStorage.getItem('token') },
                url: "/api/show",
                data: {
                },
                success: function (response) {
                    let name_check = response['name'] // ì ‘ì†í•œ ì‚¬ëŒ ì´ë¦„ // ì¢‹ì•„ìš” í–ˆëŠ”ì§€ ì•ˆí–ˆëŠ”ì§€ ì²´í¬ìš©
                    let post_list = response['post_list'] // post ì „ì²´ ë¡œìš° ê¸ì–´ ì˜¤ê¸°

                    // ë°˜ë³µë¬¸ìœ¼ë¡œ like_userì— í˜„ì¬ ì ‘ì†í•œ ì‚¬ëŒì˜ ì´ë¦„ì´ ìˆìœ¼ë©´ ì¢‹ì•„ìš” ì´ë¯¸ í•œ ê±°ë‹ˆê¹Œ
                    // í•˜ì–€ìƒ‰ í•˜íŠ¸ ì•„ë‹ˆë©´ ë¹¨ê°„ìƒ‰ í•˜íŠ¸
                    for (let i = 0; i < post_list.length; i++) {
                        if (post_list[i]["like_user"].includes(name_check) == true) {
                            let tempHtml = ` 
                        <div style="width:500px; margin:auto;">
                            <hr>
                            <button onclick="location.href='/detail?instaId=${post_list[i]["post_Id"]}'" style = "float:left; border:none; outline:none; background:none;" >  â–¶ </button >
                        <h3 style="color:orange">ê¸€ì“´ì´ : ${post_list[i]["name"]}
                            <button style="float:right; border:none; outline:none; background:none;" onclick="like(${post_list[i]["post_Id"]})">â¤  ${post_list[i]["like_count"]}</button>
                            
                            </h3>
                            <h4>ë‚´ìš© : ${post_list[i]["content"]}</h4>
                            <hr>
                            </div>
                            `

                            $("#board_list").append(tempHtml);
                        }

                        if (post_list[i]["like_user"].includes(name_check) == false) {
                            let tempHtml = `
                        <div style="width:500px; margin:auto;">
                            <hr>
                            <button onclick="location.href='/detail?instaId=${post_list[i]["post_Id"]}'" style = "float:left; border:none; outline:none; background:none;" >  â–¶ </button >
                        <h3 style="color:orange">ê¸€ì“´ì´ : ${post_list[i]["name"]}
                            <button style="float:right; border:none; outline:none; background:none;" onclick="like(${post_list[i]["post_Id"]})">ğŸ¤  ${post_list[i]["like_count"]}</button>
                            
                            </h3>
                            <h4>ë‚´ìš© : ${post_list[i]["content"]}</h4>
                            <hr>
                            </div>
                            `
                            $("#board_list").append(tempHtml);

                        }
                    }

                },
            });
        }

        //ì¢‹ì•„ìš”!
        function like(post_Id) {
            $.ajax({
                type: "POST",
                headers: { token: localStorage.getItem('token') },
                url: "/api/like",
                data: {
                    post_Id: post_Id
                },
                success: function (response) {
                }
            });
            window.location.href = "/home";
        }

    </script>

</body>

</html>